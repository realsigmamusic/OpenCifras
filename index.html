<!doctype html>
<html lang="pt-br">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenCifras</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<link rel="stylesheet" href="style.css">

	<script>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', () => {
				navigator.serviceWorker.register('./sw.js')
					.then(() => console.log('App pronto para uso Offline!'))
					.catch((err) => console.log('Erro no SW:', err));
			});
		}
	</script>
	<link rel="manifest" href="./manifest.json">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta name="apple-mobile-web-app-title" content="OpenCifras">
	<meta name="theme-color" content="#e9ecef"> <!-- .bg-body-secondary (dark = #343a40 light = #e9ecef) -->
	<link rel="apple-touch-icon" href="maskable_icon_x512.png">

	<script src="https://cdn.jsdelivr.net/npm/tonal@latest/browser/tonal.min.js"></script>
</head>

<body>
	<!-- CABEÇALHO -->
	<nav class="navbar bg-body-secondary mb-3 fixed-top">
		<div class="container-fluid">
			<a class="navbar-brand" href="https://github.com/realsigmamusic/OpenCifras">
				<h1 class="fw-bolder">
					<i class="bi bi-music-note-list"></i>
					OpenCifras
				</h1>
			</a>
			<ul class="navbar-nav justify-content-between align-items-center">
				<li class="nav-item">
					<button class="btn btn-link nav-link" onclick="alternarTema()" id="btn-tema">
						<i class="bi bi-moon-fill" id="icone-tema"></i>
					</button>
				</li>
			</ul>
		</div>
	</nav>

	<div class="container" style="padding-top: 90px; padding-bottom: 90px;">
		<!-- LISTA -->
		<div id="tela-lista" class="tela tela-ativa">
			<h4 class="mb-3">Repertório</h4>
			<form class="d-flex" role="search" id="form-busca" onsubmit="return false;">
				<input class="form-control me-2" type="search" placeholder="Buscar música..." aria-label="Search"
					id="input-busca">
				<button class="btn btn-primary" type="button" onclick="filtrarLista()">
					<i class="bi bi-search"></i>
				</button>
			</form>
			<div class="list-group list-group-flush mt-3" id="lista-musicas">
				<div class="text-center text-muted mt-5">Carregando...</div>
				<div class="text-center">
					<div class="spinner-border mt-5" role="status">
						<span class="visually-hidden">Loading...</span>
					</div>
				</div>
			</div>
		</div>

		<!-- LEITOR -->
		<div id="tela-leitor" class="tela">
			<div
				class="d-flex justify-content-center align-items-center gap-3 mb-4 p-2 bg-secondary bg-gradient bg-opacity-10 rounded">
				<button class="btn btn-secondary btn-sm fw-bold" onclick="mudarTom(-1)">
					<i class="bi bi-arrow-down"></i>
				</button>
				<span id="display-tom" class="fw-light text-center fs-6">Tom</span>
				<button class="btn btn-secondary btn-sm fw-bold" onclick="mudarTom(1)">
					<i class="bi bi-arrow-up"></i>
				</button>

				<div class="vr mx-2 text-secondary"></div>

				<div class="btn-group" role="group">
					<button class="btn btn-secondary btn-sm" onclick="mudarTamanhoFonte(-10)">
						<i class="bi bi-dash-lg"></i>
					</button>
					<button class="btn btn-secondary btn-sm" onclick="resetarFonte()">
						<i class="bi bi-arrow-counterclockwise"></i>
					</button>
					<button class="btn btn-secondary btn-sm" onclick="mudarTamanhoFonte(10)">
						<i class="bi bi-plus-lg"></i>
					</button>
				</div>

				<div class="vr mx-2 text-secondary"></div>

				<button class="btn btn-primary btn-sm" onclick="editarAtual()">
					<i class="bi bi-pencil-square"></i>
				</button>
			</div>

			<h1 id="titulo-musica" class="mb-1"></h1>
			<p id="detalhes-musica" class="mb-3"></p>

			<div id="render-area" class=""></div>
		</div>

		<!-- EDITOR -->
		<div id="tela-editor" class="tela">
			<h4 class="mb-3">Editor</h4>

			<input type="hidden" id="editor-id">

			<div class="mb-3">
				<label for="editor-titulo" class="form-label">Título</label>
				<input type="text" class="form-control mb-1" id="editor-titulo" placeholder="Nome da música...">
				<label for="editor-artista" class="form-label">Artista</label>
				<input type="text" class="form-control" id="editor-artista" placeholder="Nome do artista...">
			</div>

			<div class="mb-3">
				<label for="editor-conteudo" class="form-label">Cifra</label>
				<textarea class="form-control font-monospace" id="editor-conteudo" rows="12"
					placeholder="Cifra no formato ChordMark..."></textarea>
				<div class="form-text">Aprenda a usar o ChordMark <a
						href="https://chordmark.netlify.app/docs/getting-started" target="_blank">AQUI!</a> </div>
			</div>

			<div class="d-flex justify-content-between gap-2">
				<button class="btn btn-danger" onclick="deletarAtual()">
					<i class="bi bi-trash"></i> Excluir
				</button>
				<button class="btn btn-secondary" onclick="cancelarEdicao()">
					<i class="bi bi-x-circle"></i> Cancelar
				</button>
				<button class="btn btn-primary" onclick="salvarMusica()">
					<i class="bi bi-floppy"></i> Salvar
				</button>
			</div>
		</div>

	</div>

	<!-- BACKUP MODAL -->
	<div class="modal fade shadow" id="modalBackup" tabindex="-1">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Backup & Restauração</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body text-center">

					<h6 class="text-primary fw-bold mb-3">Salvar Repertório (Exportar)</h6>
					<p class="small text-muted">Baixe um arquivo contendo todas as suas músicas.</p>
					<button class="btn btn-outline-primary w-100 mb-4" onclick="exportarDados()">
						Baixar Backup (.json)
					</button>

					<hr>

					<h6 class="text-warning fw-bold mb-3 mt-4">Restaurar Repertório (Importar)</h6>
					<p class="small text-muted">Carregue um arquivo de backup. <br>Isso adicionará as músicas ao banco
						atual.</p>

					<input type="file" id="input-importar" accept=".json" style="display: none"
						onchange="importarDados(this)">

					<button class="btn btn-outline-warning w-100"
						onclick="document.getElementById('input-importar').click()">
						Selecionar Arquivo
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- ACORDE MODAL -->
	<div class="modal fade" id="modalAcorde" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-sm">
			<div class="modal-content">
				<div class="modal-header bg-primary text-white">
					<h5 class="modal-title fw-bold"><i class="bi bi-info-circle"></i></h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body text-center">
					<h6 class="text-muted mb-1">Informações sobre o acorde:</h6>
					<h1 class="fs-1 fw-bold text-primary" id="titulo-acorde">C</h1>
					<p id="aliases-acorde">M, ^, , maj</p>
					<hr>
					<div class="d-flex justify-content-center align-items-center gap-3">
						<div class="">
							<h6 class="text-muted mb-1">Notas</h6>
							<p class="mb-0" id="notas-acorde">C, E, G</p>
						</div>
						<div class="vr" style="min-height: 50px;"></div>
						<div class="">
							<h6 class="text-muted mb-1">Intervalos</h6>
							<i class="mb-0" id="intervalos-acorde">1P - 3M - 5P</i>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- RODAPÉ -->
	<footer class="bg-body-secondary fixed-bottom">
		<div class="container">
			<div class="d-flex justify-content-around align-items-center py-2">

				<button class="btn nav-link text-decoration-none d-flex flex-column align-items-center p-1"
					onclick="navegar('lista')">
					<i class="bi bi-list-ul fs-5"></i>
					<small style="font-size: 0.7rem;">Repertório</small>
				</button>

				<button class="btn nav-link text-decoration-none d-flex flex-column align-items-center p-1"
					onclick="navegar('editor')">
					<i class="bi bi-plus-circle-fill fs-1"></i> </button>

				<button class="btn nav-link text-decoration-none d-flex flex-column align-items-center p-1"
					data-bs-toggle="modal" data-bs-target="#modalBackup">
					<i class="bi bi-hdd-network fs-5"></i>
					<small style="font-size: 0.7rem;">Backup</small>
				</button>

			</div>
		</div>
	</footer>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://unpkg.com/dexie@3/dist/dexie.js"></script>
	<script type="module" src="js/app.js"></script>
</body>

</html>