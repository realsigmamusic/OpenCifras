<!doctype html>
<html lang="pt-br">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenCifras</title>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<link rel="stylesheet" href="style.css">

	<script>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', () => {
				navigator.serviceWorker.register('./sw.js')
					.then(() => console.log('App pronto para uso Offline!'))
					.catch((err) => console.log('Erro no SW:', err));
			});
		}
	</script>
	<link rel="manifest" href="./manifest.json">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta name="apple-mobile-web-app-title" content="OpenCifras">
	<meta name="theme-color" content="#e9ecef"> <!-- .bg-body-secondary (dark = #343a40 light = #e9ecef) -->
	<link rel="apple-touch-icon" href="maskable_icon_x512.png">

	<script src="https://cdn.jsdelivr.net/npm/tonal@latest/browser/tonal.min.js"></script>
</head>

<body>
	<!-- CABEÇALHO -->
	<nav class="navbar bg-body-secondary mb-3 fixed-top">
		<div class="container-fluid">
			<a class="navbar-brand" href="https://github.com/realsigmamusic/OpenCifras" target="_blank">
				<h1 class="fw-bolder">
					<i class="bi bi-music-note-list"></i>
					OpenCifras
				</h1>
			</a>
			<ul class="navbar-nav justify-content-between align-items-center">

			</ul>
		</div>
	</nav>

	<div class="container" style="padding-top: 90px; padding-bottom: 90px;">
		<!-- LISTA -->
		<div id="tela-lista" class="tela tela-ativa">
			<h4 class="mb-3">Repertório</h4>
			<form class="d-flex" role="search" id="form-busca" onsubmit="return false;">
				<input class="form-control me-2" type="search" placeholder="Buscar música..." aria-label="Search"
					id="input-busca">
				<button class="btn btn-primary" type="button" onclick="filtrarLista()">
					<i class="bi bi-search"></i>
				</button>
			</form>
			<div class="list-group list-group-flush mt-3" id="lista-musicas">
				<div class="text-center text-muted mt-5">Carregando...</div>
				<div class="text-center">
					<div class="spinner-border mt-5" role="status">
						<span class="visually-hidden">Loading...</span>
					</div>
				</div>
			</div>
		</div>

		<!-- LEITOR -->
		<div id="tela-leitor" class="tela">
			<div
				class="d-flex justify-content-center align-items-center gap-2 mb-4 p-2 bg-secondary bg-gradient bg-opacity-10 rounded">
				<button class="btn btn-secondary btn-sm fw-bold" onclick="mudarTom(-1)">
					<i class="bi bi-arrow-down"></i>
				</button>
				<button id="display-tom" class="btn btn-sm bg-secondary bg-opacity-10 fw-light text-center"
					onclick="resetarTom()">
					Tom
				</button>
				<button class="btn btn-secondary btn-sm fw-bold" onclick="mudarTom(1)">
					<i class="bi bi-arrow-up"></i>
				</button>

				<div class="vr mx-2 text-secondary"></div>

				<div class="btn-group" role="group">
					<button class="btn btn-secondary btn-sm" onclick="mudarTamanhoFonte(-10)">
						<i class="bi bi-dash-lg"></i>
					</button>
					<button class="btn btn-secondary btn-sm" onclick="resetarFonte()">
						<i class="bi bi-arrow-counterclockwise"></i>
					</button>
					<button class="btn btn-secondary btn-sm" onclick="mudarTamanhoFonte(10)">
						<i class="bi bi-plus-lg"></i>
					</button>
				</div>

				<div class="vr mx-2 btn-secondary text-secondary"></div>

				<button class="btn btn-secondary btn-sm" onclick="editarAtual()">
					Editar
				</button>
			</div>

			<h1 id="titulo-musica" class="mb-1"></h1>
			<p id="detalhes-musica" class="mb-3"></p>

			<div id="render-area" class=""></div>
		</div>

		<!-- EDITOR -->
		<div id="tela-editor" class="tela">
			<h4 class="mb-3">Editor</h4>

			<input type="hidden" id="editor-id">

			<div class="mb-3">
				<label for="editor-titulo" class="form-label mt-2">Título</label>
				<input type="text" class="form-control mb-1" id="editor-titulo" placeholder="Nome da música...">
				<label for="editor-artista" class="form-label mt-2">Artista</label>
				<input type="text" class="form-control" id="editor-artista" placeholder="Nome do artista...">
			</div>

			<div class="mb-3">
				<div class="d-flex justify-content-between align-bottom mb-2">
					<label for="editor-conteudo" class="form-label mt-2">Cifra (ChordMark)</label>
					<button type="button" class="btn btn-sm btn-outline-primary btn-inserir" data-char="#">#</button>
					<button type="button" class="btn btn-sm btn-outline-primary btn-inserir" data-char="_">_</button>
					<button type="button" class="btn btn-sm btn-outline-primary btn-inserir" data-char="/">/</button>
					<button type="button" class="btn btn-sm btn-outline-warning" id="btn-importar-cifra">
						<i class="bi bi-arrow-clockwise"></i>
						Converter cifra
					</button>
				</div>
				<textarea class="form-control font-monospace" id="editor-conteudo" rows="9"
					placeholder="Cifra no formato ChordMark..."></textarea>
				<div class="form-text">Aprenda a usar o ChordMark <a
						href="https://chordmark.netlify.app/docs/getting-started" target="_blank">AQUI!</a> </div>
			</div>

			<div class="d-flex justify-content-between gap-2">
				<button class="btn btn-danger" onclick="deletarAtual()">
					<i class="bi bi-trash"></i> Excluir
				</button>
				<button class="btn btn-secondary" onclick="cancelarEdicao()">
					<i class="bi bi-x-circle"></i> Cancelar
				</button>
				<button class="btn btn-primary" onclick="salvarMusica()">
					<i class="bi bi-floppy"></i> Salvar
				</button>
			</div>
		</div>

	</div>

	<!-- MODAL INFORMAÇÃO DO ACORDE -->
	<div class="modal fade" id="modalAcorde" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-sm">
			<div class="modal-content">
				<div class="modal-header bg-body-secondary">
					<h5 class="modal-title fw-bold"><i class="bi bi-info-circle"></i></h5>
					<button type="button" class="btn-close btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body text-center">
					<h6 class="text-muted mb-1">Informações sobre o acorde:</h6>
					<h1 class="fs-1 fw-bold text-primary" id="titulo-acorde">C</h1>
					<p id="aliases-acorde">M, ^, , maj</p>
					<hr>
					<div class="d-flex justify-content-center align-items-center gap-3">
						<div class="">
							<h6 class="text-muted mb-1">Notas</h6>
							<p class="mb-0" id="notas-acorde">C, E, G</p>
						</div>
						<div class="vr" style="min-height: 50px;"></div>
						<div class="">
							<h6 class="text-muted mb-1">Intervalos</h6>
							<i class="mb-0" id="intervalos-acorde">1P - 3M - 5P</i>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- MODAL SETTINGS -->
	<div class="modal fade shadow" id="modalSettings" tabindex="-1">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header bg-body-secondary">
					<h1 class="modal-title fw-bold">
						Configurações
					</h1>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<h3 class="mb-3">Personalização</h3>
					<p class="mb-1">Modo de vizualização:</p>
					<select class="form-select mb-3" id="select-view" onchange="alterarModoVisualizacao()">
						<option value="opencifras">OpenCifras</option>
						<option value="minimalist">Minimalista</option>
					</select>
					<p class="mb-1">Temas:</p>
					<select class="form-select mb-3" id="tema" onchange="alternarTema(this.value)">
						<option value="light">Tema claro</option>
						<option value="dark">Tema escuro</option>
					</select>
					<hr>
					<h3 class="mb-3">Backup</h3>
					<p>Arquivo <code>.json</code> com todas as suas músicas.</p>
					<div class="d-flex justify-content-center align-items-center gap-3">
						<div class="col-5">
							<button class="btn btn-outline-primary w-100" onclick="exportarDados()">
								<i class="bi bi-box-arrow-in-up"></i>
								Exportar
							</button>
						</div>
						<div class="vr"></div>
						<div class="col-5">
							<input type="file" id="input-importar" accept=".json" style="display: none"
								onchange="importarDados(this)">
							<button class="btn btn-outline-warning w-100"
								onclick="document.getElementById('input-importar').click()">
								<i class="bi bi-box-arrow-in-down"></i>
								Importar
							</button>
						</div>
					</div>
					<hr class="my-4">
					<div class="text-center">
						<p class="small text-muted mb-2">
							<i class="bi bi-heart-fill"></i>
							Gostou do aplicativo? <br>
							Faça uma doação
							<i class="bi bi-coin"></i>
						</p>
						<button class="btn btn-sm btn-outline-danger w-100" onclick="copiarPix()">
							Copiar chave PIX
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- RODAPÉ -->
	<footer class="bg-body-secondary fixed-bottom">
		<div class="container">
			<div class="d-flex justify-content-around align-items-center py-2">

				<button class="btn nav-link text-decoration-none d-flex flex-column align-items-center p-1"
					onclick="navegar('lista')">
					<i class="bi bi-list-ul fs-5"></i>
					<small style="font-size: 0.7rem;">Repertório</small>
				</button>

				<button class="btn nav-link text-decoration-none d-flex flex-column align-items-center p-1"
					onclick="navegar('editor')">
					<i class="bi bi-plus-circle-fill fs-1"></i> </button>

				<button class="btn nav-link text-decoration-none d-flex flex-column align-items-center p-1"
					data-bs-toggle="modal" data-bs-target="#modalSettings">
					<i class="bi bi-sliders fs-5"></i>
					<small style="font-size: 0.7rem;">Configurações</small>
				</button>

			</div>
		</div>
	</footer>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://unpkg.com/dexie@3/dist/dexie.js"></script>
	<script type="module" src="js/app.js"></script>
</body>

</html>