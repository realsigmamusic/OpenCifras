<!doctype html>
<html lang="pt-br" data-bs-theme="auto">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<meta name="apple-mobile-web-app-title" content="OpenCifras">
	<meta name="theme-color" content="#e9ecef"> <!-- .bg-body-secondary (dark = #343a40 light = #e9ecef) -->

	<title>OpenCifras</title>

	<link rel="icon" href="./music-note-list.svg" type="image/svg+xml">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
	<link rel="apple-touch-icon" href="maskable_icon_x512.png">
	<link rel="stylesheet" href="style.css">

	<script>
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', () => {
				navigator.serviceWorker.register('./sw.js')
					.then(() => console.log('App pronto para uso Offline!'))
					.catch((err) => console.log('Erro no SW:', err));
			});
		}
	</script>
	<link rel="manifest" href="./manifest.json">

	<script src="https://cdn.jsdelivr.net/npm/tonal@latest/browser/tonal.min.js"></script>
</head>

<body>
	<!-- CABEÇALHO -->
	<header>
		<nav class="navbar bg-body-secondary mb-3 fixed-top border-0">
			<div class="container-fluid">
				<a class="navbar-brand" href="https://github.com/realsigmamusic/OpenCifras" target="_blank">
					<h1 class="fw-bolder">
						<i class="bi bi-music-note-list"></i>
						OpenCifras
					</h1>
				</a>
			</div>
		</nav>
	</header>

	<main class="container" style="margin-top: 90px; margin-bottom: 90px;">
		<!-- LISTA -->
		<section id="tela-lista" class="tela tela-ativa">
			<h1 class="mb-3">Músicas</h1>
			<form class="d-flex" role="search" id="form-busca" onsubmit="return false;">
				<input class="form-control me-2" type="search" placeholder="Buscar música..." aria-label="Search"
					id="input-busca">
				<button class="btn btn-primary" type="button" onclick="filtrarLista()">
					<i class="bi bi-search"></i>
				</button>
			</form>
			<div class="d-flex gap-2 overflow-auto py-2 my-2" id="filtro-artistas"
				style="white-space: nowrap; -webkit-overflow-scrolling: touch;">
			</div>
			<div class="list-group list-group-flush mt-3" id="lista-musicas">
				<div class="text-center text-muted mt-5">Carregando...</div>
				<div class="text-center">
					<div class="spinner-border mt-5" role="status">
						<span class="visually-hidden">Loading...</span>
					</div>
				</div>
			</div>
		</section>

		<!-- LEITOR -->
		<section id="tela-leitor" class="tela">
			<div class="fixed-top d-flex justify-content-center align-items-center gap-2 p-2 pb-3 bg-body-secondary"
				style="margin-top: 55px;">
				<button class="btn btn-secondary btn-sm fw-bold" onclick="mudarTom(-1)">
					<i class="bi bi-arrow-down"></i>
				</button>
				<button id="display-tom" class="btn btn-sm bg-secondary bg-opacity-10 fw-light text-center"
					onclick="resetarTom()">
					Tom
				</button>
				<button class="btn btn-secondary btn-sm fw-bold" onclick="mudarTom(1)">
					<i class="bi bi-arrow-up"></i>
				</button>

				<div class="vr mx-2 text-secondary"></div>

				<div class="btn-group" role="group">
					<button class="btn btn-secondary btn-sm" onclick="mudarTamanhoFonte(-10)">
						<i class="bi bi-dash-lg"></i>
					</button>
					<button class="btn btn-secondary btn-sm" onclick="resetarFonte()">
						<i class="bi bi-arrow-counterclockwise"></i>
					</button>
					<button class="btn btn-secondary btn-sm" onclick="mudarTamanhoFonte(10)">
						<i class="bi bi-plus-lg"></i>
					</button>
				</div>

				<div class="vr mx-2 btn-secondary text-secondary"></div>

				<div class="dropdown">
					<button class="btn btn-link text-body p-0" type="button" data-bs-toggle="dropdown"
						aria-expanded="false">
						<i class="bi bi-three-dots-vertical fs-3"></i>
					</button>
					<ul class="dropdown-menu dropdown-menu-end shadow">
						<li>
							<button class="dropdown-item" onclick="editarAtual()">
								<i class="bi bi-pencil me-2"></i>
								Editar
							</button>
						</li>
						<li>
							<hr class="dropdown-divider">
						</li>
						<button class="dropdown-item" data-bs-toggle="modal" data-bs-target="#modalSettings">
							<i class="bi bi-sliders me-2"></i>
							Configurações
						</button>
						<li>
							<hr class="dropdown-divider">
						</li>
						<li>
							<button class="dropdown-item text-danger" onclick="deletarAtual()">
								<i class="bi bi-trash me-2"></i>
								Excluir Música
							</button>
						</li>
					</ul>
				</div>
			</div>
			<section style="margin-top: 8rem;">
				<h1 id="titulo-musica" class="mb-1"></h1>
				<p id="detalhes-musica" class="mb-3"></p>
				<div id="render-area" class=""></div>
			</section>
		</section>

		<!-- EDITOR -->
		<section id="tela-editor" class="tela">
			<h1 class="mb-3">Editor de música</h1>

			<input type="hidden" id="editor-id">

			<div class="mb-3">
				<label for="editor-titulo" class="form-label mt-2">Título</label>
				<input type="text" class="form-control mb-1" id="editor-titulo" placeholder="Nome da música...">
				<label for="editor-artista" class="form-label mt-2">Artista</label>
				<input type="text" class="form-control" id="editor-artista" placeholder="Nome do artista...">
			</div>

			<div class="mb-3">
				<div class="d-flex justify-content-start align-bottom mb-3 gap-3">
					<div class="dropdown">
						<button class="btn btn-sm btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
							aria-expanded="false" title="Ferramentas de Formatação">
							Converter cifra
						</button>
						<ul class="dropdown-menu shadow">
							<li>
								<p class="dropdown-header">Qual o formato de origem?</p>
							</li>
							<li>
								<button class="dropdown-item" onclick="converterCifra('chordsOverLyrics')">
									Acordes sobre a letra
								</button>
							</li>
							<li>
								<button class="dropdown-item" onclick="converterCifra('chordPro')">
									ChordPro
								</button>
							</li>
						</ul>
					</div>
					<div class="vr"></div>
					<button class="btn btn-sm btn-outline-secondary btn-inserir" data-char="#">#</button>
					<button class="btn btn-sm btn-outline-secondary btn-inserir" data-char="_">_</button>
					<button class="btn btn-sm btn-outline-secondary btn-inserir" data-char="/">/</button>
					<button class="btn btn-sm btn-outline-secondary btn-inserir" data-char="%">%</button>
					<div class="dropdown">
						<button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button"
							data-bs-toggle="dropdown" aria-expanded="false" title="Ferramentas de Formatação"></button>
						<ul class="dropdown-menu shadow">
							<li><button class="dropdown-item btn-inserir" data-char="key">key</button></li>
							<li><button class="dropdown-item btn-inserir" data-char="4/4">4/4</button></li>
							<li>
								<hr class="dropdown-divider">
							</li>
							<li><button class="dropdown-item btn-inserir" data-char="#i">Intro</button></li>
							<li><button class="dropdown-item btn-inserir" data-char="#v">Verse</button></li>
							<li><button class="dropdown-item btn-inserir" data-char="#p">Pre-chorus</button></li>
							<li><button class="dropdown-item btn-inserir" data-char="#c">Chorus</button></li>
							<li><button class="dropdown-item btn-inserir" data-char="#s">Solo</button></li>
							<li><button class="dropdown-item btn-inserir" data-char="#b">Bridge</button></li>
							<li><button class="dropdown-item btn-inserir" data-char="#o">Outro</button></li>
							<li><button class="dropdown-item btn-inserir" data-char="#u">Interlude</button></li>
							<li><button class="dropdown-item btn-inserir" data-char="#a">Adlib</button></li>
						</ul>
					</div>
				</div>
				<textarea class="form-control font-monospace" id="editor-conteudo" rows="9"
					placeholder="Cifra no formato ChordMark..."></textarea>
				<div class="form-text">Aprenda a usar o ChordMark
					<a class="link-info" href="https://chordmark.netlify.app/docs/getting-started"
						target="_blank">AQUI!</a>
				</div>
			</div>

			<div class="d-flex justify-content-between gap-2">
				<button class="btn btn-secondary" onclick="cancelarEdicao()">
					<i class="bi bi-x-circle"></i> Cancelar
				</button>
				<button class="btn btn-primary" onclick="salvarMusica()">
					<i class="bi bi-floppy"></i> Salvar
				</button>
			</div>
		</section>

		<!-- AFINADOR -->
		<section id="tela-afinador" class="tela">
            <h1 class="mb-4 text-center">Afinador</h1>

            <div class="d-grid gap-2 col-8 mx-auto mb-4">
                <button id="btn-power-tuner" class="btn btn-outline-success" onclick="alternarAfinador()">
                    <i class="bi bi-power"></i> Ligar Afinador
                </button>
            </div>

            <div id="tuner-interface" class="d-none">
                
                <p class="text-center text-muted mb-2">Selecione a corda que vai afinar:</p>

                <div class="d-flex justify-content-center gap-2 mb-4">
                    <button class="btn btn-sm btn-outline-secondary btn-corda" onclick="selecionarCorda('E2', this)">E <sup>6ª</sup><br><small style="font-size:0.6rem">082.41</small></button>
                    <button class="btn btn-sm btn-outline-secondary btn-corda" onclick="selecionarCorda('A2', this)">A <sup>5ª</sup><br><small style="font-size:0.6rem">110.00</small></button>
                    <button class="btn btn-sm btn-outline-secondary btn-corda" onclick="selecionarCorda('D3', this)">D <sup>4ª</sup><br><small style="font-size:0.6rem">146.83</small></button>
                    <button class="btn btn-sm btn-outline-secondary btn-corda" onclick="selecionarCorda('G3', this)">G <sup>3ª</sup><br><small style="font-size:0.6rem">196.00</small></button>
                    <button class="btn btn-sm btn-outline-secondary btn-corda" onclick="selecionarCorda('B3', this)">B <sup>2ª</sup><br><small style="font-size:0.6rem">246.94</small></button>
                    <button class="btn btn-sm btn-outline-secondary btn-corda" onclick="selecionarCorda('E4', this)">E <sup>1ª</sup><br><small style="font-size:0.6rem">329.63</small></button>
                </div>

                <div class="text-center mb-3">
                    <h1 class="display-1 fw-bold" id="display-nota">--</h1>
                    <span class="badge bg-secondary mb-2" id="display-freq">0 Hz</span>
                    <h4 id="display-status" class="text-muted">Selecione uma corda</h4>
                </div>

                <div class="progress" style="height: 30px; font-size: 1rem;">
                    <div id="tuner-bar" class="progress-bar bg-warning" role="progressbar" style="width: 50%; transition: width 0.1s linear;">
                        <span id="bar-text"></span>
                    </div>
                </div>
                
                <div class="d-flex justify-content-between text-muted mt-1 small">
                    <span>Apertar (Baixo)</span>
                    <span>Afrouxar (Alto)</span>
                </div>
            </div>
        </section>

		<!-- CONFIGURAÇÕES -->
		<section id="tela-config" class="tela">
			<h1 class="mb-3">
				OpenCifras
				<span id="app-version" class="mx-2 fs-6">...</span>
			</h1>
			<label class="mb-1">Temas:</label>
			<select class="form-select mb-3" id="tema" onchange="alternarTema(this.value)">
				<option value="light">Tema claro</option>
				<option value="dark">Tema escuro</option>
			</select>
			<label class="mb-1">Modo de vizualização da música:</label>
			<select class="form-select mb-3" id="select-view" onchange="alterarModoVisualizacao()">
				<option value="opencifras">OpenCifras</option>
				<option value="chordmark">ChordMark</option>
				<option value="minimalist">Minimalista</option>
				<option value="lyric">Letra</option>
				<option value="chords">Acordes</option>
			</select>
			<hr>
			<h3 class="mb-3">Backup</h3>
			<p class="mb-2">Arquivo <code>.json</code> com todas as suas músicas.</p>
			<div class="d-flex justify-content-center align-items-center gap-3">
				<div class="col-5">
					<button class="btn btn-outline-primary w-100" onclick="exportarDados()">
						<i class="bi bi-box-arrow-in-up"></i>
						Exportar
					</button>
				</div>
				<div class="vr"></div>
				<div class="col-5">
					<input type="file" id="input-importar" accept=".json" style="display: none"
						onchange="importarDados(this)">
					<button class="btn btn-outline-warning w-100"
						onclick="document.getElementById('input-importar').click()">
						<i class="bi bi-box-arrow-in-down"></i>
						Importar
					</button>
				</div>
			</div>
		</section>

	</main>

	<!-- MODAL INFORMAÇÃO DO ACORDE -->
	<div class="modal fade" id="modalAcorde" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-sm">
			<div class="modal-content">
				<div class="modal-header bg-body-secondary">
					<h5 class="modal-title fw-bold"><i class="bi bi-info-circle"></i></h5>
					<button type="button" class="btn-close btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body text-center">
					<h6 class="text-muted mb-1">Informações sobre o acorde:</h6>
					<h1 class="fs-1 fw-bold text-primary" id="titulo-acorde">C</h1>
					<p id="aliases-acorde">M, ^, , maj</p>
					<hr>
					<div class="d-flex justify-content-center align-items-center gap-3">
						<div class="">
							<h6 class="text-muted mb-1">Notas</h6>
							<p class="mb-0" id="notas-acorde">C, E, G</p>
						</div>
						<div class="vr" style="min-height: 50px;"></div>
						<div class="">
							<h6 class="text-muted mb-1">Intervalos</h6>
							<i class="mb-0" id="intervalos-acorde">1P - 3M - 5P</i>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- RODAPÉ -->
	<footer class="bg-body-secondary fixed-bottom">
		<div class="container">
			<div class="d-flex justify-content-around align-items-center py-2">

				<button class="btn nav-link text-decoration-none d-flex flex-column align-items-center p-1"
					onclick="navegar('lista')">
					<i class="bi bi-list-ul fs-5"></i>
					<small style="font-size: 0.7rem;">Músicas</small>
				</button>

				<button class="btn nav-link text-decoration-none d-flex flex-column align-items-center p-1"
					onclick="navegar('editor')">
					<i class="bi bi-plus-circle fs-5"></i>
					<small style="font-size: 0.7rem;">Editor</small>
				</button>

				<button class="btn nav-link text-decoration-none d-flex flex-column align-items-center p-1"
					onclick="navegar('afinador')">
					<i class="bi bi-mic fs-5"></i>
					<small style="font-size: 0.7rem;">Afinador</small>
				</button>

				<button class="btn nav-link text-decoration-none d-flex flex-column align-items-center p-1"
					onclick="navegar('config')">
					<i class="bi bi-sliders fs-5"></i>
					<small style="font-size: 0.7rem;">Configurações</small>
				</button>

			</div>
		</div>
	</footer>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://unpkg.com/dexie@3/dist/dexie.js"></script>
	<script type="module" src="js/app.js"></script>
	<script src="./js/tuner.js"></script>
</body>

</html>